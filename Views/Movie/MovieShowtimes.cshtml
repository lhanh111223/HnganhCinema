@* @model HnganhCinema.ViewModels.Movie.MovieShowtimeViewModel *@
@model CinemaWeb.Models.Movie
@{
    ViewData["Title"] = "Showtime";
}


<head>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="~/css/movieshowtimes.css" rel="stylesheet" />

    <style>
        .custom-select {
            min-width: 350px;
            position: relative;
        }

        select {
            appearance: none;
            /*  safari  */
            -webkit-appearance: none;
            /*  other styles for aesthetics */
            width: 100%;
            font-size: 1.15rem;
            padding: 0.675em 6em 0.675em 1em;
            background-color: #fff;
            border: 1px solid #caced1;
            border-radius: 0.25rem;
            color: #000;
            cursor: pointer;
        }

        .custom-select::before,
        .custom-select::after {
            --size: 0.3rem;
            content: "";
            position: absolute;
            right: 1rem;
            pointer-events: none;
        }

        .custom-select::before {
            border-left: var(--size) solid transparent;
            border-right: var(--size) solid transparent;
            border-bottom: var(--size) solid black;
            top: 40%;
        }

        .custom-select::after {
            border-left: var(--size) solid transparent;
            border-right: var(--size) solid transparent;
            border-top: var(--size) solid black;
            top: 55%;
        }

        * {
            box-sizing: border-box;
        }

        #movie-detail img {
            width: 15rem;
            height: 15rem;
        }

        #movie-detail h3 {
            width: 15rem;
        }
    </style>

</head>
<section class="timeline_area section_padding_130">
    <div class="container ">
        <div class=" row col-md-12" id="movie-detail">
            <div class="col-md-4">
                <img src="/Contents/MovieImage/@Model.Image" />
                <h3>@Model.MovieName</h3>
            </div>
            <div class="col-md-8">
                <p>
                    @Html.Raw(Model.Description)
                </p>
                <ul>
                    <li><b>Actors: </b> <span>Tom Holland, Zendaya, Benedict Cumberbatch, ...</span></li>
                    <li><b>Time: </b> <span>@Model.Time <samp>minutes</samp></span></li>
                    <li><b>Release Date: </b> <span>@Model.ReleaseDate.ToShortDateString()</span></li>
                    <li><b>Gernes: </b> <span>Action, Adventure, Fantasy, ...</span></li>

                </ul>
            </div>
        </div>
        <div style="margin-top: 2rem;" class="row justify-content-center">
            <div class="col-12 col-sm-8 col-lg-6">
                <!-- Section Heading-->
                <div class="section_heading text-center">
                    <h3>SELECT CINEMA</h3>
                    <select id="cinema-id" onchange="getMovieShowtimesData()" class="custom-select" asp-items="@ViewBag.Cinemas"></select>
                    <input type="hidden" id="movie-id" value="@ViewBag.MovieId" />
                    <div class="line"></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <!-- Showtime Area-->
                <div id="showtime-body" class="apland-timeline-area">
                </div>
            </div>
        </div>
    </div>
    <a style="margin-top: 15rem;" class="btn btn-primary btn-sm" href="@Url.Action("MovieDetail","Movie", new{id = Model.MovieId})">Back to Movie Detail</a>
</section>



@section Scripts{
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>

    <script>



        $(document).ready(function () {
            getMovieShowtimesData();
        });

        function getMovieShowtimesData() {
            let movieid = $('#movie-id').val();
            let cinemaid = $('#cinema-id').val();
            var data = {
                movieid: movieid,
                cinemaid: cinemaid
            };
            let html = '';

            $.ajax({
                async: false,
                url: '@Url.Action("GetShowtimeOfMovie", "Movie")',
                type: 'POST',
                dataType: 'json',
                data: data,
                success: function (data) {
                    if (data.success) {
                        console.log(data.showtime);
                        for (var i = 0; i < data.date.length; i++) {

                            html += (
                                '<div class="single-timeline-area">' +
                                '<div class="timeline-date wow fadeInLeft" data-wow-delay="0.1s" style="visibility: visible; animation-delay: 0.1s; animation-name: fadeInLeft;">' +
                                '<h4>' + data.date[i] + '</h4>' +
                                '</div>'
                            );
                            html += ('<div class="row">');
                            for (var j = 0; j < data.showtime.length; j++) {
                                if (data.showtime[j].startDate === data.date[i]) {
                                    html += (
                                        '<div class="col-12 col-md-4 col-lg-2">' +
                                        '<a href="#">' +
                                        '<div class="single-timeline-content d-flex wow fadeInLeft" data-wow-delay="0.3s" style="visibility: visible; animation-delay: 0.3s; animation-name: fadeInLeft;">' +
                                        '<div class="timeline-icon"><i class="fa fa-clock-o" aria-hidden="true"></i></div>' +
                                        '<div class="timeline-text">' +
                                        '<h6>' + data.showtime[j].startTime + '</h6>' +
                                        '<p>' + ' Room: ' + data.showtime[j].roomNo + '</p>' +
                                        '</div>' +
                                        '</div>' +
                                        '</a>' +
                                        '</div>'
                                    );
                                }

                            }
                            html += ('</div>');
                            html += ('</div>');
                        }
                        
                    } else {
                        html = ('<h1>NO SHOWTIMES</h1>');
                    }
                    $('#showtime-body').html(html);
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

    </script>

}